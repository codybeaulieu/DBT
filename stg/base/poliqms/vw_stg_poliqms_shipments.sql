with src as (
    select 
        *   
         ,'{{source('poliqms','shipments')}}' as etl_src_table_name
         ,'POLIQMS'                           as source_system
    from {{source('poliqms','shipments')}}
)
,deduped as (
    select
        *,
        row_number() over (partition by id order by _rivery_last_update desc) row_nbr
    from src
)
select
	id,
	packslipno,
	ship_via,
	fob,
	userid,
	shipdate,
	ps_date,
	arcusto_custno,
	arcusto_company,
	arcusto_addr1,
	arcusto_addr2,
	arcusto_addr3,
	arcusto_city,
	arcusto_state,
	arcusto_country,
	arcusto_zip,
	arcusto_phone_number,
	arcusto_ext,
	arcusto_fax_number,
	arcusto_prime_contact,
	ship_to_attn,
	ship_to_addr1,
	ship_to_addr2,
	ship_to_addr3,
	ship_to_city,
	ship_to_state,
	ship_to_country,
	ship_to_zip,
	ship_to_ship_time,
	ship_to_tax_code_id,
	ship_to_phone_number,
	ship_to_ext,
	ship_to_fax,
	ship_to_prime_contact,
	ship_to_note,
	bill_to_attn,
	bill_to_addr1,
	bill_to_addr2,
	bill_to_addr3,
	bill_to_city,
	bill_to_state,
	bill_to_country,
	bill_to_zip,
	bill_to_phone_number,
	bill_to_ext,
	bill_to_fax,
	bill_to_prime_contact,
	terms_descrip,
	terms_days,
	terms_discount,
	terms_discount_days,
	freight_descrip,
	pro_no,
	ship_time,
	est_arrival,
	conveyance_no,
	box_code,
	to_invoice,
	arcusto_id,
	edi_created,
	bol_comment1,
	shipment_type,
	auto_freight_price,
	eplant_id,
	archived,
	print_count,
	print_last_user,
	print_last_date,
	ps_ticket_id,
	tracking_num,
	vmi,
	ship_to_id,
	bill_to_id,
	pool_bill_number,
	pallet_count,
	bol_id,
	freight_id,
	ups_boxcount,
	ups_boxweight,
	ps_ticket_batch,
	manifest_shipped,
	ship_residential,
	comment1,
	content_type,
	ship_to_country_code,
	bill_to_country_code,
	master_shipment_id,
	freight_autoded_applied,
	company_id,
	manifest_contact,
	inventory_verified_userid,
	inventory_verified_date,
	fob_third_party_id,
	ignore_dist_center,
	cuser1,
	manifest_contact_email,
	trailno,
	note,
	credit_card_freight,
	tsc_trailer_id,
	is_rack,
	accrued_freight,
	arcusto_country_id,
	ship_to_country_id,
	bill_to_country_id,
	arcusto_state_id,
	ship_to_state_id,
	bill_to_state_id,
	pallet_charge,
	pallet_count_billable,
	dist_routing_rules_id,
	ds_source,
	ds_notifications,
	_rivery_river_id,
	_rivery_run_id,
	_rivery_last_update,
    etl_src_table_name,
    source_system
from deduped
where row_nbr = 1
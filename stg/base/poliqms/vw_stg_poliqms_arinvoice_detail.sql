with src as (
    select 
        *   
         ,'{{source('poliqms','arinvoice_detail')}}' as etl_src_table_name
         ,'POLIQMS'                                  as source_system
    from {{source('poliqms','arinvoice_detail')}}
)
,deduped as (
    select
        *,
        row_number() over (partition by id order by _rivery_last_update desc) row_nbr
    from src
)
select
	id,
	arinvoice_id,
	shipment_dtl_id,
	ord_detail_id,
	invoice_qty,
	glacct_id_sales,
	freight_id,
	tax_code_id,
	salespeople_id,
	comm_pcnt,
	freight_price,
	unit_price,
	arinvt_id,
	misc_comment,
	salespeople_sales_code,
	arinvt_class,
	arinvt_itemno,
	arinvt_rev,
	arinvt_descrip,
	arinvt_descrip2,
	freight_descrip,
	reference,
	ref_code_descrip,
	ref_code_category,
	ref_code,
	ref_code_id,
	price_per_1000,
	price_per_1000_yn,
	cust_itemno,
	cust_descrip,
	std_cost,
	misc_po,
	cost_object_id,
	cost_object_source,
	eplant_id,
	po_detail_id,
	rma_detail_id,
	vmi_reference,
	cm_arinvoice_id,
	no_post_std_cost,
	po_receipts_id,
	cust_rev,
	shipments_autoded_id,
	sac_shipment_dtl_id,
	glacct_id_freight,
	shipment_dtl_id2,
	total_rebate,
	rebate_calc_date,
	rebate_params_id,
	actual_cost_posted,
	list_unit_price,
	discount,
	pono_from_so,
	freight_rev_amount,
	freight_rev_pcnt,
	acct_id_freight_rev,
	orig_freight_price,
	edi_ship_to_id,
	shipment_cogs_glbatchid_id,
	shipment_cogs_glprepost_id,
	include_freight,
	tax_rate,
	ship_to_id,
	misc_orders_id,
	vmi_consumption_id,
	sac_ord_detail_id,
	phantom_ord_detail_id,
	phantom_dtl_modified,
	is_retro,
	so_discount_type_id,
	so_discount_type_amount,
	so_discount_type_percent,
	tax_exempt_amount,
	credit_memo_no_cogs,
	invoice_no_cogs,
	pallet_charge,
	pallet_count,
	acct_id_pallet_charge,
	_rivery_river_id,
	_rivery_run_id,
	_rivery_last_update,
    etl_src_table_name,
    source_system
from deduped
where row_nbr = 1
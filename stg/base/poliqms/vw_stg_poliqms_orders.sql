with src as (
    select 
        *   
         ,'{{source('poliqms','orders')}}' as etl_src_table_name
         ,'POLIQMS'                        as source_system
    from {{source('poliqms','orders')}}
)
,deduped as (
    select
        *,
        row_number() over (partition by id order by _rivery_last_update desc) row_nbr
    from src
)
select
    id,
	orderno,
	pono,
	arcusto_id,
	ord_date,
	ord_by,
	userid,
	date_taken,
	bill_to_id,
	ship_to_id,
	cuser1,
	cuser2,
	cuser3,
	cuser5,
	cuser6,
	timestamp,
	fob,
	changeuser_id,
	terms_id,
	freight_id,
	free_form,
	discount,
	contact_id,
	ecode,
	eid,
	edate_time,
	ecopy,
	currency_id,
	type,
	rev,
	oe_control,
	eplant_id,
	edi_855_created,
	print_count,
	print_last_user,
	print_last_date,
	web_orders_id,
	edi_change_date,
	web_change_date,
	aggregate_calculated,
	inter_consign,
	arcusto_credit_card_id,
	division_id,
	cuser4,
	crm_quote_id,
	alt_division_id,
	comment1,
	payment_type,
	ext_comment1,
	ord_line_date,
	freight_charge,
	freight_quoteno,
	apply_freight_bol_to_ps,
	contact_id2,
	campaign_id,
	crm_opportunity_id,
	fob_third_party_id,
	drop_ship_po_id,
	edi_865_created,
	approved,
	approval_required,
	freight_account_number,
	is_draft,
	is_manual_outsource,
	is_quick_order,
	ship_complete,
	tax_calculated,
	accrued_freight,
	ict_manual_ship_to_id,
	so_discount_type_id,
	so_discount_type_total_amount,
	so_discount_type_percent,
	status,
	pallet_charge,
	pallet_charge_source,
	use_pallet_charge,
	dist_routing_rules_id,
	ds_source,
	_rivery_river_id,
	_rivery_run_id,
	_rivery_last_update,
    etl_src_table_name,
    source_system
from deduped
where row_nbr = 1
with src as (
    select 
        *   
         ,'{{source('poliqms','ord_detail')}}' as etl_src_table_name
         ,'POLIQMS'                            as source_system
    from {{source('poliqms','ord_detail')}}
)
,deduped as (
    select
        *,
        row_number() over (partition by id order by _rivery_last_update desc) row_nbr
    from src
)
select
	id,
	orders_id,
	arinvt_id,
	ord_det_seqno,
	total_qty_ord,
	cumm_shipped,
	onhold,
	tax_code_id,
	misc_item,
	comment1,
	unit_price,
	salespeople_id,
	comm_pct,
	price_per_1000,
	list_unit_price,
	discount,
	ecode,
	eid,
	edate_time,
	ecopy,
	eplant_id,
	cost_object_id,
	cost_object_source,
	unit,
	uom_factor,
	glacct_id,
	dockid,
	linefeed,
	reservelocation,
	kbtrigger,
	aggregate_discount,
	cust_cum_start,
	last_receipt_qty,
	last_receipt_date,
	rma_detail_id,
	ref_code_id,
	fab_qty,
	raw_mt_qty,
	fab_start_date,
	fab_end_date,
	containers,
	from_sales_option,
	ship_to_id_from,
	in_transit_workorder_id,
	in_transit_partno_id,
	is_drop_ship,
	is_make_to_order,
	mfg_quan,
	po_info,
	make_to_order_ps_ticket_dtl_id,
	campaign_id,
	ctp,
	crm_quote_detail_id,
	sales_option_choice_id,
	cuser1,
	cuser2,
	cuser3,
	rebate_params_id,
	phantom_ord_detail_id,
	phantom_ptsper,
	hide,
	outsource_po_detail_id,
	lot_charge_arinvt_id,
	standard_id,
	division_id,
	aka_kind,
	msds_upload,
	shiphold,
	lot_charge_ord_detail_id,
	milk_run_locations_id,
	auto_invoice,
	c_po_misc_id,
	misc_itemno,
	phantom_dtl_modified,
	bogo_ord_detail_id,
	bogo_ar_discount_tiers_id,
	bogo_exception,
	price_book_id,
	price_book_price_type_id,
	_rivery_river_id,
	_rivery_run_id,
	_rivery_last_update,
    etl_src_table_name,
    source_system
from deduped
where row_nbr = 1
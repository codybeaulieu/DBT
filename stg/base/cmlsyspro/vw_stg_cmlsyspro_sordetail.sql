with src as (
    select 
        *   
         ,'{{source('cmlsyspro','sordetail')}}' as etl_src_table_name
         ,'CMLSYSPRO'                                as source_system
    from {{source('cmlsyspro','sordetail')}}
)
,deduped as (
    select
        *,
        row_number() over (partition by salesorder,salesorderline order by _rivery_last_update desc) row_nbr
    from src
)
select
	salesorder,
	salesorderline,
	linetype,
	mstockcode,
	mstockdes,
	mwarehouse,
	mbin,
	morderqty,
	mshipqty,
	mbackorderqty,
	munitcost,
	mbomflag,
	mparentkittype,
	mqtyper,
	mscrappercentage,
	mprintcomponent,
	mcomponentseq,
	mqtychangesflag,
	moptionalflag,
	mdecimals,
	morderuom,
	mstockqtytoshp,
	mstockinguom,
	mconvfactordum,
	mmuldivprcfct,
	mprice,
	mpriceuom,
	mcommissioncode,
	mdiscpct1,
	mdiscpct2,
	mdiscpct3,
	mdiscvalflag,
	mdiscvalue,
	mproductclass,
	mtaxcode,
	mlineshipdate,
	mallocstatsched,
	mfsttaxcode,
	mstockunitmass,
	mstockunitvol,
	mpricecode,
	mconvfactalloc,
	mmuldivqtyfct,
	mtraceabletype,
	mmpsflag,
	mpickingslip,
	mmovementreqd,
	mserialmethod,
	mzeroqtycrnote,
	mabcapplied,
	mmpsgrossreqd,
	mcontract,
	mbuyinggroup,
	mcussupstkcode,
	mcusretailprice,
	mtariffcode,
	mlinereceiptdat,
	mleadtime,
	mtrfcostmult,
	msupplementaryun,
	mreviewflag,
	mreviewstatus,
	minvoiceprinted,
	mdelnoteprinted,
	mordackprinted,
	mhierarchyjob,
	mcustrequestdat,
	mlastdelnote,
	muserdef,
	mqtydispatched,
	mdiscchanged,
	mcreditorderno,
	mcreditorderline,
	munitquantity,
	mconvfactunitq,
	maltuomunitq,
	mdecimalsunitq,
	meccflag,
	mversion,
	mrelease,
	mcommitdate,
	qtyreserved,
	ncomment,
	ncommentfromlin,
	nmscchargevalue,
	nmscproductcls,
	nmscchargecost,
	nmscinvcharge,
	ncommenttype,
	nmsctaxcode,
	nmscfstcode,
	ncommenttexttyp,
	nmscchargeqty,
	nsrvinctotal,
	nsrvsummary,
	nsrvchargetype,
	nsrvparentline,
	nsrvunitprice,
	nsrvunitcost,
	nsrvqtyfactor,
	nsrvapplyfactor,
	nsrvdecimalrnd,
	nsrvdecrndflag,
	nsrvminvalue,
	nsrvmaxvalue,
	nsrvmuldiv,
	nprtoninv,
	nprtondel,
	nprtonack,
	ntaxamountflag,
	ndepretflagproj,
	nretentionjob,
	nsrvminquantity,
	nchargecode,
	includeinmrp,
	productcode,
	librarycode,
	materialallocline,
	scrapquantity,
	fixedqtyperflag,
	fixedqtyper,
	multishipcode,
	user1,
	creditreason,
	origshipdateaps,
	tpmusageflag,
	promotioncode,
	tpmsequence,
	salesorderinitline,
	preactorpriority,
	salesorderdetstat,
	salesorderresstat,
	qtyreservedship,
	timestamp,
	qtyreleasedtopick,
	picknumber,
	intrastatexempt,
	triangulationrole,
	triangdispstate,
	triangdeststate,
	origcountry,
	pricegrouprule,
	_rivery_river_id,
	_rivery_run_id,
	_rivery_last_update,
    etl_src_table_name,
 	source_system
from deduped
where row_nbr = 1
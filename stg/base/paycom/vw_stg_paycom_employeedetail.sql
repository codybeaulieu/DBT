with src as (
    select 
        *   
         ,'{{source('paycom','employeedetail')}}'  as etl_src_table_name
         ,'PAYCOM'                                 as source_system
         ,sysdate()                                as elt_load_datetime
    from {{source('paycom','employeedetail')}}
)
,deduped as (
    select
        *,
        row_number() over (partition by employee_code order by birth_date desc) row_nbr
    from src
),batch_id as (
select uuid_string() as batch_id
)
select
	actual_marital_status,
    actual_marital_status_description,
    age,
    alternate_pay_frequency,
    apt_suite_other,
    available_health_insurance,
    birth_date,
    business_title,
    city,
    clocksequencenumber,
    cobra_end,
    cobra_start,
    comission_only,
    current_key_employee,
    custom_standard_hours,
    department_code,
    department_description,
    eeoc_class,
    eeoc_class_description,
    ee_message,
    eligible_401k,
    emergency_1_contact,
    emergency_1_phone,
    emergency_1_relationship,
    emergency_2_contact,
    emergency_2_phone,
    emergency_2_relationship,
    emergency_3_contact,
    emergency_3_phone,
    emergency_3_relationship,
    employee_added,
    employee_badge,
    employee_code,
    employee_gl_code,
    employee_name,
    employee_status,
    employee_supervisor_level,
    employee_supervisor_pin,
    employee_terminal_group,
    employee_terminal_group_description,
    employee_type_1099,
    ethnic_background,
    firstname,
    fulltime_or_parttime,
    gender,
    has_direct_deposit,
    highly_comp_employee,
    hire_date,
    hourly_or_salary,
    hours_401k,
    labor_allocation_details,
    lastname,
    last_pay_change,
    last_position_change_date,
    last_review,
    leave_end,
    leave_start,
    length_of_service_since_hire,
    length_of_service_since_rehire,
    location,
    match_eligible,
    manager_level,
    middlename,
    most_recent_check_date,
    new_hire,
    new_hire_report_date,
    next_review,
    nickname,
    non_resident_alien,
    parttime_to_fulltime_date,
    part_num_401k,
    participation_401k,
    pay_class,
    pay_frequency,
    personal_email,
    position,
    position_code,
    position_family,
    position_family_code,
    position_family_name,
    position_id,
    position_level,
    position_seat_number,
    position_seat_title,
    position_title,
    previous_termination_date,
    primary_phone,
    primary_phone_type,
    primary_schedule_group_description,
    print_ee_message,
    rehire_date,
    report_new_hire,
    retirement_plan,
    schedule_group,
    schedule_time_zone,
    secondary_phone,
    secondary_phone_type,
    seniority_date,
    state,
    statutory_employee,
    street,
    supervisor_approval,
    supervisor_approval_code,
    supervisor_primary,
    supervisor_primary_code,
    supervisor_quaternary,
    supervisor_quaternary_code,
    supervisor_secondary,
    supervisor_secondary_code,
    supervisor_talent,
    supervisor_talent_management,
    supervisor_tertiary,
    supervisor_tertiary_code,
    termination_reason,
    termination_type,
    termination_date,
    union_code,
    vets_4212_emp_category,
    vets_4212_job_category,
    workers_comp_code,
    workers_comp_desc,
    work_email,
    zipcode,
    cat1,
    cat1desc,
    cat2,
    cat2desc,
    cat3,
    cat3desc,
    cat4,
    cat4desc,
    cat5,
    cat5desc,
    cat6,
    cat6desc,
    cat7,
    cat7desc,
    cat8,
    cat8desc,
    cat9,
    cat9desc,
    cat10,
    cat10desc,
    cat11,
    cat11desc,
    cat12,
    cat12desc,
    cat13,
    cat13desc,
    cat14,
    cat14desc,
    cat15,
    cat15desc,
    cat16,
    cat16desc,
    cat17,
    cat17desc,
    cat18,
    cat18desc,
    cat19,
    cat19desc,
    cat20,
    cat20desc,
    companylocationid,
    companyestablishmentid,
    dol_status,
    exempt_status,
    etl_src_table_name,
 	source_system,
    elt_load_datetime,
    batch_id
from deduped left join batch_id 
where row_nbr = 1
